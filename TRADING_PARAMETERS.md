# 套利机器人交易参数说明

## 📊 当前配置（edgex-paradex-arbitrage-bot.ts）

### 💰 交易数量
```
TRADE_AMOUNT: 0.01 BTC
```
**每次开仓交易 0.01 BTC**

---

## 🔄 开仓逻辑

### 开仓条件
```typescript
ARB_THRESHOLD: 30 USD  // 价差 ≥ 30美元时开仓
```

### 开仓示例

**场景1: EdgeX价格更低**
- EdgeX: $95,000
- Paradex: $95,030
- **价差**: $30 ✅
- **操作**:
  - ✅ EdgeX **买入** 0.01 BTC @ $95,000
  - ✅ Paradex **卖出** 0.01 BTC @ $95,030
  - 💰 **预期利润**: $30 × 0.01 = $0.30

**场景2: Paradex价格更低**
- EdgeX: $95,030
- Paradex: $95,000
- **价差**: $30 ✅
- **操作**:
  - ✅ EdgeX **卖出** 0.01 BTC @ $95,030
  - ✅ Paradex **买入** 0.01 BTC @ $95,000
  - 💰 **预期利润**: $30 × 0.01 = $0.30

---

## ⚠️ 平仓逻辑 - 发现问题！

### 当前配置（有问题）
```typescript
CLOSE_DIFF: 50 USD
```

### 当前代码逻辑（第295行）
```typescript
currentSpread <= CONFIG.CLOSE_DIFF  // 价差 ≤ 50美元时平仓
```

### ❌ 问题分析

这个逻辑**反了**！正确的套利平仓应该是：

#### 套利原理
1. **开仓时**: 两个交易所价差大（≥30美元）→ 低买高卖
2. **平仓时**: 等价差缩小 → 平仓锁定利润

#### 当前逻辑问题
- **开仓**: 价差 ≥ 30美元 ✅ 正确
- **平仓**: 价差 ≤ 50美元 ❌ **错误！**

这意味着：
- 开仓条件：价差 ≥ 30
- 平仓条件：价差 ≤ 50

**问题**: 价差从30涨到50反而不会平仓！这不合理。

---

## ✅ 正确的平仓逻辑

套利平仓应该在**价差缩小**时触发，例如：

### 方案A: 价差缩小到接近0
```typescript
CLOSE_THRESHOLD: 5 USD  // 价差 ≤ 5美元时平仓（价差缩小）
```

### 方案B: 价差逆转
```typescript
// 价差从30缩小到10以下时平仓
CLOSE_THRESHOLD: 10 USD
```

### 方案C: 动态止盈（推荐）
```typescript
PROFIT_TARGET: 0.8  // 价差回撤80%时平仓

// 示例:
// 开仓时价差: 30美元
// 平仓触发: 价差 ≤ 30 × (1 - 0.8) = 6美元
```

---

## 📋 其他平仓条件

### 1. 超时强制平仓
```typescript
FORCE_CLOSE_TIME: 30 * 60 * 1000  // 30分钟
```
持仓超过30分钟自动平仓（避免资金占用）

### 2. 止损
```typescript
STOP_LOSS: 0.15  // 15%
```
亏损超过15%时止损平仓

### 3. 最大价差限制
```typescript
MAX_SPREAD: 150 USD
```
价差超过150美元时不开仓（可能是异常数据）

---

## 🎯 推荐参数配置

### 保守策略（适合测试）
```typescript
TRADE_AMOUNT: 0.01 BTC
ARB_THRESHOLD: 50 USD        // 价差≥50美元开仓
CLOSE_THRESHOLD: 10 USD      // 价差≤10美元平仓
MAX_POSITIONS: 1
STOP_LOSS: 0.10              // 10%止损
FORCE_CLOSE_TIME: 30分钟
```

### 激进策略（适合实盘）
```typescript
TRADE_AMOUNT: 0.05 BTC
ARB_THRESHOLD: 30 USD        // 价差≥30美元开仓
CLOSE_THRESHOLD: 5 USD       // 价差≤5美元平仓
MAX_POSITIONS: 3
STOP_LOSS: 0.15              // 15%止损
FORCE_CLOSE_TIME: 60分钟
```

---

## 📊 完整参数列表

| 参数 | 当前值 | 说明 | 建议值 |
|------|--------|------|--------|
| **TRADE_AMOUNT** | 0.01 BTC | 每次交易量 | 0.01-0.05 BTC |
| **ARB_THRESHOLD** | 30 USD | 开仓价差阈值 | 30-50 USD |
| **CLOSE_DIFF** ⚠️ | 50 USD | 平仓价差（逻辑错误） | 改为 5-10 USD |
| **MAX_SPREAD** | 150 USD | 最大价差限制 | 100-200 USD |
| **MAX_POSITIONS** | 1 | 最大持仓数 | 1-3 |
| **STOP_LOSS** | 15% | 止损百分比 | 10-20% |
| **FORCE_CLOSE_TIME** | 30分钟 | 强制平仓时间 | 30-60分钟 |
| **OPEN_LOCK_DURATION** | 10秒 | 开仓后锁定期 | 10-30秒 |
| **CLOSE_LOCK_DURATION** | 30秒 | 平仓后冷却期 | 30-60秒 |

---

## 🔧 需要修改的代码

### 文件: edgex-paradex-arbitrage-bot.ts

#### 1. 修改配置（第26行）
```typescript
// 修改前
CLOSE_DIFF: 50,  // 50美元价差平仓

// 修改后
CLOSE_THRESHOLD: 10,  // 价差≤10美元时平仓（价差缩小）
```

#### 2. 修改平仓逻辑（第295行）
```typescript
// 修改前
currentSpread <= CONFIG.CLOSE_DIFF  // ❌ 错误

// 修改后
currentSpread <= CONFIG.CLOSE_THRESHOLD  // ✅ 正确
```

---

## 💡 套利示例（完整流程）

### 示例交易

**T0: 检测到机会**
- EdgeX: $95,000
- Paradex: $95,035
- 价差: **$35** ≥ 30 ✅ → **开仓**

**T1: 开仓执行**
- EdgeX **买入** 0.01 BTC @ $95,000
- Paradex **卖出** 0.01 BTC @ $95,035
- 持仓建立 ✅

**T2: 价格变动监控**
- 5分钟后:
  - EdgeX: $95,010
  - Paradex: $95,025
  - 价差: **$15**

**T3: 价差继续缩小**
- 10分钟后:
  - EdgeX: $95,015
  - Paradex: $95,020
  - 价差: **$5** ≤ 10 ✅ → **平仓触发**

**T4: 平仓执行**
- EdgeX **卖出** 0.01 BTC @ $95,015
- Paradex **买入** 0.01 BTC @ $95,020
- 平仓完成 ✅

**盈亏计算**:
- EdgeX: ($95,015 - $95,000) × 0.01 = **+$0.15**
- Paradex: ($95,035 - $95,020) × 0.01 = **+$0.15**
- **总利润**: $0.30（扣除手续费前）

---

## ⚠️ 风险提示

1. **滑点风险**: 实际成交价可能与预期不同
2. **手续费**: 开仓+平仓共4笔交易的手续费
3. **资金费率**: Paradex永续合约有资金费率
4. **流动性**: 0.01 BTC通常流动性充足
5. **网络延迟**: WebSocket虽快但仍有延迟

---

**生成时间**: 2025-10-04
**状态**: ⚠️ 需要修复平仓逻辑
