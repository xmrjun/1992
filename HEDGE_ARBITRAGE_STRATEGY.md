# 双向对冲套利策略说明

## 🎯 策略核心

### 对冲套利（Delta Neutral Arbitrage）

**原理**: 在两个交易所之间建立对冲头寸，锁定价差，等待价差收敛获利

**关键**:
- ✅ 不赌方向（涨跌都无所谓）
- ✅ 赚取价差收敛
- ✅ 低风险（双边对冲）

---

## ⚙️ 当前配置

```typescript
TRADE_AMOUNT: 0.005 BTC        // 每次开仓数量
ARB_THRESHOLD: 100 USD         // 价差 ≥ 100 开仓
CLOSE_THRESHOLD: 40 USD        // 价差 ≤ 40 平仓
MAX_POSITIONS: 5               // 最多5个仓位
STOP_LOSS: 20%                 // 止损20%
无强制平仓时间                  // 持续持有直到价差收敛
```

---

## 📊 交易逻辑详解

### 开仓逻辑（价差 ≥ 100）

#### 场景A: EdgeX价格更低
```
EdgeX:   $95,000  (低)
Paradex: $95,120  (高)
价差:    $120 ≥ 100 ✅

开仓操作：
EdgeX:   买入（开多）0.005 BTC @ $95,000
Paradex: 卖出（开空）0.005 BTC @ $95,120
```

#### 场景B: Paradex价格更低
```
EdgeX:   $95,120  (高)
Paradex: $95,000  (低)
价差:    $120 ≥ 100 ✅

开仓操作：
EdgeX:   卖出（开空）0.005 BTC @ $95,120
Paradex: 买入（开多）0.005 BTC @ $95,000
```

### 平仓逻辑（价差 ≤ 40）

#### 接上面场景A的平仓
```
持仓状态：
EdgeX:   多头 0.005 BTC @ $95,000
Paradex: 空头 0.005 BTC @ $95,120

价差收敛：
EdgeX:   $95,030
Paradex: $95,065
价差:    $35 ≤ 40 ✅

平仓操作：
EdgeX:   卖出（平多）0.005 BTC @ $95,030
Paradex: 买入（平空）0.005 BTC @ $95,065

利润计算：
EdgeX:   ($95,030 - $95,000) × 0.005 = $0.15
Paradex: ($95,120 - $95,065) × 0.005 = $0.275
总利润:  $0.425（扣除手续费前）
```

---

## 💰 盈利来源

### 价差收敛收益

开仓时价差: $120
平仓时价差: $35
收敛幅度: $85

理论收益 = 收敛幅度 × 交易量
         = $85 × 0.005
         = $0.425

### 实际收益（考虑手续费）

假设使用限价单（Maker）：
- EdgeX Maker: 0.02%
- Paradex Maker: 0.02%

手续费计算（4笔交易）：
- 本金: $95,000 × 0.005 = $475
- 单笔手续费: $475 × 0.02% = $0.095
- 4笔总计: $0.095 × 4 = $0.38

**净利润**: $0.425 - $0.38 = **$0.045** ✅

---

## 🔄 双向套利示例

### 同时持有多个仓位

机器人可以同时持有最多5个套利仓位：

```
仓位1（EdgeX低）：
EdgeX 多头 + Paradex 空头
开仓价差: $110, 当前价差: $85

仓位2（Paradex低）：
EdgeX 空头 + Paradex 多头
开仓价差: $105, 当前价差: $90

仓位3（EdgeX低）：
EdgeX 多头 + Paradex 空头
开仓价差: $130, 当前价差: $100

... 最多5个
```

### 为什么允许多个仓位？

1. **价差波动**: 价差可能多次超过100，每次都是机会
2. **风险分散**: 不同时间开仓，降低集中风险
3. **提高收益**: 捕获更多套利机会

---

## ⚠️ 风险管理

### 1. 止损机制
```typescript
STOP_LOSS: 20%
```

**触发条件**: 单个仓位亏损超过20%

**极端情况**:
- 某个交易所出现单边大幅波动
- 例如: EdgeX暴跌10%，Paradex正常
- 你的EdgeX多头会亏损
- 触发止损保护

### 2. 最大价差限制
```typescript
MAX_SPREAD: 500 USD
```

**作用**: 价差 > 500 美元时不开仓

**原因**:
- 可能是数据错误
- 可能是极端市场事件
- 可能是某个交易所暂停交易

### 3. 交易锁定
```typescript
OPEN_LOCK_DURATION: 10秒   // 开仓后10秒内不再开仓
CLOSE_LOCK_DURATION: 30秒  // 平仓后30秒冷却
```

**作用**: 避免频繁交易，降低手续费

---

## 📈 策略优势

### ✅ 低风险
- 双边对冲，不受单边行情影响
- BTC涨跌都不影响收益
- 只赚价差收敛

### ✅ 无需预测
- 不需要预测涨跌方向
- 只需要价差大于阈值

### ✅ 可持续
- 价差会周期性扩大和收敛
- 持续有套利机会

### ✅ 自动化
- 机器人24小时监控
- 自动开仓平仓

---

## 📉 策略风险

### ❌ 手续费侵蚀
- 每次套利4笔交易
- 如果用市价单（Taker），手续费很高
- **解决**: 使用限价单（Maker）

### ❌ 滑点
- 市价单可能有滑点
- 实际成交价与预期不符
- **解决**: 使用限价单，控制价格

### ❌ 流动性不足
- 大额交易可能找不到对手盘
- 0.005 BTC通常没问题
- **解决**: 分批下单

### ❌ 资金费率（Paradex）
- 永续合约有资金费率
- 每8小时结算一次
- 多头/空头需支付或收取
- **影响**: 长期持仓会累积资金费率成本

### ❌ 单边极端行情
- 某个交易所单边暴涨暴跌
- 虽然有对冲，但可能触发止损
- **解决**: 20%止损保护

---

## 💡 优化建议

### 1. 使用限价单（重要！）

**当前**: 市价单（Taker 0.05%）
**建议**: 限价单（Maker 0.02%）

**修改方法**:
```typescript
// 开仓时使用当前价格的限价单
const edgexLimitPrice = this.edgexPrice;
const paradexLimitPrice = this.paradexPrice;

// 改为限价单
await edgexAPI.createOrder('BTCUSD', 'limit', 'buy', 0.005, edgexLimitPrice);
```

### 2. 动态调整阈值

根据市场波动性调整：
- 低波动期: 降低阈值到 80
- 高波动期: 提高阈值到 120

### 3. 监控资金费率

Paradex永续合约资金费率：
- 如果长期持有空头，可能需支付资金费率
- 监控并在资金费率高时平仓

### 4. 增加交易量（谨慎）

如果策略稳定盈利：
- 从 0.005 BTC 提升到 0.01 BTC
- 利润翻倍，但风险也翻倍

---

## 📊 实际收益估算

### 假设条件
- 开仓价差: 100-150 美元
- 平仓价差: 20-40 美元
- 收敛幅度: 60-110 美元（平均85美元）
- 手续费: Maker 0.02% × 4 = 0.08%

### 单次套利收益
```
收敛收益: $85 × 0.005 = $0.425
手续费:   $475 × 0.08% = $0.38
净利润:   $0.045

收益率:   $0.045 / $475 = 0.0095% ≈ 0.01%
```

### 每天收益（假设）
假设每天5次套利机会：
```
日收益: $0.045 × 5 = $0.225
周收益: $0.225 × 7 = $1.575
月收益: $0.225 × 30 = $6.75
```

⚠️ **注意**: 这只是理想估算，实际收益受市场波动影响

---

## 🎯 总结

### 策略本质
**赚取两个交易所之间的价差收敛，与BTC涨跌无关**

### 关键参数
- 0.005 BTC 每次
- 100 USD 开仓
- 40 USD 平仓
- 无强制平仓时间

### 成功要素
1. ✅ 使用限价单（Maker）
2. ✅ 控制手续费
3. ✅ 避免滑点
4. ✅ 监控资金费率
5. ✅ 严格止损

---

**文档时间**: 2025-10-04
**策略**: 双向对冲套利
**状态**: ✅ 已配置
